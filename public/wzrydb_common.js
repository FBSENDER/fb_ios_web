var heroUrl="/wzry/hero/",equipUrl="./equip/";$(function(){function tab(o1,o2,c,e){o1.each(function(i){$(this).bind(e,function(){o2.hide().eq(i).show();o1.removeClass(c);$(this).addClass(c)});if($(this).hasClass(c)){$(this).addClass(c);o2.hide().eq(i).show()}})}lazyLoad.init();(function(){var HeroSearchBox=$("#HeroSearchBox"),HeroResultBox=$("#HeroResultBox"),resultItem=HeroResultBox.find(".mod-iconitem"),priceOption=HeroSearchBox.find('select[name="price"]').find("option");var priceArray=[];for(var i=1;i<priceOption.length-1;i++){priceArray.push(parseInt(priceOption.eq(i).val()))}HeroSearchBox.find(".select-box").each(function(index,el){var _self=$(this),s_input=_self.find(".input-box"),s_value=s_input.find(".value"),s_select=s_input.find("select");s_select.on("change",function(){event.preventDefault();s_value.html(s_select.find("option:selected").text());var category=HeroSearchBox.find('select[name="category"]').val(),attack=HeroSearchBox.find('select[name="attack"]').val(),position=HeroSearchBox.find('select[name="position"]').val(),price=HeroSearchBox.find('select[name="price"]').val();if(!category&&!attack&&!position&&!price){resultItem.show()}else{resultItem.hide().filter(function(index){var _self=$(this),_selfData=_self.data(),_selfDataCategory=""+_selfData.category,_selfDataType=""+_selfData.type,_selfDataPosition=""+_selfData.position;if((!_selfDataCategory||_self.data().category==category||category=="0"||!category)&&(!_selfDataType||_self.data().type.indexOf(attack)>-1||attack=="0"||!attack)&&(!_selfDataPosition||_self.data().position.indexOf(position)>-1||position=="0"||!position)){if(price=="other"){if(priceArray.indexOf(_self.data().price)<0){return this}}else if(_self.data().price==price||price=="0"||!price){return this}}}).show()}if(resultItem.filter(":visible").length<1){var noResult=HeroResultBox.find(".no-result");if(noResult.length){noResult.show()}else{HeroResultBox.append('<p class="no-result">sorry！目前并无此英雄</p>')}}else{var noResult=HeroResultBox.find(".no-result");if(noResult.length)noResult.hide()}})})})();(function(){var equipSearchBox=$("#equipSearchBox"),equipResultBox=$("#equipResultBox"),resultItem=equipResultBox.find(".mod-iconitem");equipSearchBox.find(".select-box").each(function(index,el){var _self=$(this),s_input=_self.find(".input-box"),s_value=s_input.find(".value"),s_select=s_input.find("select");s_select.on("change",function(){event.preventDefault();s_value.html(s_select.find("option:selected").text());var category=equipSearchBox.find('select[name="category"]').val(),tier=equipSearchBox.find('select[name="tier"]').val(),gj_attr=parseInt(equipSearchBox.find('select[name="gj_attr"]').val()),fy_attr=equipSearchBox.find('select[name="fy_attr"]').val();if(!category&&!tier&&!gj_attr&&!fy_attr){resultItem.show()}else{resultItem.hide().filter(function(index){var _self=$(this),_selfDate=_self.data(),_selfDateCategory=""+_selfDate.category,_selfDateTier=""+_selfDate.tier,_selfDateGj_attr=""+_selfDate.gj_attr,_selfDateFy_attr=""+_selfDate.fy_attr;if((!_selfDateCategory||_selfDateCategory==category||category=="0"||!category)&&(!_selfDateTier||_selfDateTier==tier||tier=="0"||!tier)&&(_selfDateGj_attr==""||_selfDateGj_attr.indexOf(gj_attr)>-1||gj_attr=="0"||!gj_attr)&&(!_selfDateFy_attr||_selfDateFy_attr.indexOf(fy_attr)>-1||fy_attr=="0"||!fy_attr))return this}).show()}if(resultItem.filter(":visible").length<1){var noResult=equipResultBox.find(".no-result");if(noResult.length){noResult.show()}else{equipResultBox.append('<p class="no-result">sorry！目前并无此装备</p>')}}else{var noResult=equipResultBox.find(".no-result");if(noResult.length)noResult.hide()}})})})();(function(){var _mask=$(".mod-mask"),_heroAll=$("#heroAll"),_heroAllCloseBtn=_heroAll.find(".close"),_heroAllSelect=_heroAll.find(".select-box li"),_heroAllResultItem=_heroAll.find(".mod-iconitem"),_heroInfo=$("#heroInfo"),_heroInfoIcon=_heroInfo.find("img"),_heroInfoName=_heroInfo.find("p"),_heroEquipmentItem=$("#hero-equipment-list").find(".mod-iconitem"),_changeHero=$("#changeHero"),_heroEquipAnalysis=_changeHero.siblings(".b2");_heroAllSelect.each(function(index,el){var _self=$(this),_category=_self.data().category;_self.on("click",function(event){event.preventDefault();_self.addClass("on").siblings().removeClass("on");_heroAllResultItem.hide().filter(function(index){var that=$(this);if(that.data().category==_category)return this}).show()})});_heroAllResultItem.on("click",function(event){event.preventDefault();var _self=$(this),_selfData=_self.data(),_selfDataId=_selfData.heroid;_heroInfoIcon.attr("src",all_hero[_selfDataId].icon);_heroInfoName.text(_selfData.name);maskHide();$.ajax({type:"GET",url:"http://db.18183.com/api/strategy",data:"hero="+_selfData.name,async:!0,success:function(result){result=eval("("+result+")");var equips=result.equip;for(var i=0;i<equips.length;i++){var curEquip=all_equip[equips[i]];$(_heroEquipmentItem[i]).find("a").attr("href","/wzry/equip/"+curEquip.rune_id+".html");$(_heroEquipmentItem[i]).find("img").attr("src",curEquip.info.icon);$(_heroEquipmentItem[i]).find("p").text(curEquip.name)}}});_heroEquipAnalysis.attr("href",heroUrl+_selfDataId+".html")});_heroAllCloseBtn.on("click",function(event){event.preventDefault();maskHide()});_changeHero.on("click",function(event){event.preventDefault();_mask.show()});function maskHide(){_mask.hide()}})();(function(){var equipTreeBox=$("#equipment-tree-box"),equipCustomBox=$("#equipment-custom-box"),equipSelectBox=equipCustomBox.find(".custom-tab"),equipSelectItem=equipSelectBox.find("li"),treeItem=equipTreeBox.find(".tree-item"),$line1=equipTreeBox.find(".line-1"),$line2=equipTreeBox.find(".line-2");var heroPanelUpdateBox=$("#hero-panel-update");var equipDataPanel=$("#equip-data-panel").find(".mod-des-box"),equipDataPassive=$("#equip-data-passive").find(".mod-des-box"),equipDataActive=$("#equip-data-active").find(".mod-des-box");var equipCustomItem=$(".equipment-custom-list").find("li"),equipCustomId=[];equipCustomItem.each(function(index,el){var _self=$(this);_self.on("click","span",function(event){event.preventDefault();equipCustomItem.removeClass("on");var cur=$(this);cur.parent().addClass("on")})});$("#clearEquip").on("click",function(event){event.preventDefault();equipCustomId=[];equipCustomItem.html("<span></span>");equipCustomItem.eq(0).addClass("on").siblings().removeClass("on");attributeMerge()});treeItem.each(function(){var _self=$(this);_self.on("click",function(event){event.preventDefault();var that=$(this);thatId=that.data().id,thatData=all_equip[thatId];var t1Top=[],t2Top=[],t3Top=[];if(all_equip[thatId]["tier"]==1){that.find(".line").hide();t1Top.push(that.position().top)}else if(all_equip[thatId]["tier"]==2){that.find(".line").css("width","50%");t2Top.push(that.position().top)}else if(all_equip[thatId]["tier"]==3){t3Top.push(that.position().top)}$line1.add($line2).hide();treeItem.removeClass("on");that.addClass("on");if(thatData["info"]["child_id"]!=undefined&&thatData["info"]["child_id"].length>0){var childID=thatData["info"]["child_id"].split(",");childID.map(function(ele,index){var $child=treeItem.filter(function(index){if($(this).data().id==ele)return this});$child.addClass("on");if(all_equip[ele]["tier"]==1){$child.find(".line").show();t1Top.push($child.position().top)}else if(all_equip[ele]["tier"]==2){$child.find(".line").css("width","100%");t2Top.push($child.position().top)}if(all_equip[ele]["info"]["child_id"]!=undefined&&all_equip[ele]["info"]["child_id"].length>0){var grandsonID=all_equip[ele]["info"]["child_id"].split(",");grandsonID.map(function(_ele,_index){var $grandson=treeItem.filter(function(index){if($(this).data().id==_ele)return this});$grandson.addClass("on").find(".line").show();t1Top.push($grandson.position().top)})}})}else{that.find(".line").hide()}var wrapHeight=equipTreeBox.height();if(t3Top.length>0&&t2Top.length>0){var $lin2Top=t3Top.concat(t2Top);$line2.show().css({top:Math.min.apply(null,$lin2Top)+40+"px",bottom:wrapHeight-Math.max.apply(null,$lin2Top)-41+"px"})}if(t2Top.length>0&&t1Top.length>0){var $lin1Top=t2Top.concat(t1Top);$line1.show().css({top:Math.min.apply(null,$lin1Top)+40+"px",bottom:wrapHeight-Math.max.apply(null,$lin1Top)-41+"px"})}var equipCustomItemCur=equipCustomItem.filter(".on");if(equipCustomItemCur.length>0){var imgSrc=all_equip[thatId]["info"]["icon"];equipCustomId[equipCustomItemCur.index()]=thatId;equipCustomItemCur.html('<span><img src="'+imgSrc+'" alt="" /></span><i></i>');var nextCur=equipCustomItemCur.next();if(nextCur.length>0){nextCur.addClass("on").siblings().removeClass("on")}equipCustomItemCur.find("i").on("click",function(event){event.preventDefault();var _parent=$(this).parent();_parent.html("<span></span>");equipCustomId[_parent.index()]="";attributeMerge()})}attributeMerge()})});function attributeMerge(){var heroPanelDataItem=heroPanelUpdateBox.find("dl");heroPanelDataItem.each(function(){$(this).data().percent=0;$(this).data().point=0;$(this).find("dd").text(0)});equipDataPanel.add(equipDataPassive).add(equipDataActive).find("p").remove();var equipCustomId2=$.grep(equipCustomId,function(n){return $.trim(n).length>0});if(equipCustomId2.length<1)return;equipCustomId2.map(function(ele,index){var equipData=all_equip[ele];equipDataAtter=equipData["info"]["attribute"],equipDataEffect=equipData["info"]["effect"];if(equipDataAtter!=undefined){equipDataAtter.map(function(e,i){var _curAttr=heroPanelUpdateBox.find("."+e.attribute);_curAttrData=_curAttr.data();if(e.unit=="point"){_curAttrData.point+=parseFloat(e.value)}else if(e.unit=="percent"){_curAttrData.percent+=parseFloat(e.value)}_curAttr.find("dd").text(function(){var value="";if(_curAttrData.point>0){value+="+"+_curAttrData.point.toFixed(2)}if(_curAttrData.percent>0){if(_curAttrData.point>0){value+=", "}value+="+"+_curAttrData.percent.toFixed(2)+"%"}if(_curAttrData.point==0&&_curAttrData.percent==0){value=0}return value});var equipDataPanelItem=equipDataPanel.find("."+e.attribute);if(equipDataPanelItem.length<1){equipDataPanel.append('<p class="'+e.attribute+'">'+db_config["item"]["attribute"]["attr"][e.attribute]+"："+e["value"]+db_config["item"]["attribute"]["unit"][e["unit"]]+"</p>");equipDataPanelItem=equipDataPanel.find("."+e.attribute);var itemData=equipDataPanelItem.data();itemData.point=0;itemData.percent=0;if(e["unit"]=="point"){itemData.point=e["value"]}else{itemData.percent=e["value"]}}else{var itemData=equipDataPanelItem.data();if(e["unit"]=="point"){itemData.point=(parseFloat(itemData.point)+parseFloat(e["value"])).toFixed(2)}else{itemData.percent=(parseFloat(itemData.percent)+parseFloat(e["value"])).toFixed(2)}if(itemData.point!=0&&itemData.point!=undefined){equipDataPanelItem.html("<span>"+db_config["item"]["attribute"]["attr"][e.attribute]+"：</span>"+itemData.point+db_config["item"]["attribute"]["unit"]["point"])}else if(itemData.percent!=0&&itemData.percent!=undefined){equipDataPanelItem.html("<span>"+db_config["item"]["attribute"]["attr"][e.attribute]+"：</span>"+itemData.percent+db_config["item"]["attribute"]["unit"]["percent"])}}})}equipDataEffect.map(function(e,i){switch(e.type){case"unique_passive":var _curEffect=equipDataPassive.find("[data-name="+e.name+"]");if(_curEffect.length<1){equipDataPassive.append('<p data-name="'+e.name+'" data-tier="'+equipData["tier"]+'" ><span>'+db_config.item.effect.type[e.type]+" "+e.name+"：</span>"+e.effect+"</p>")}else{if(_curEffect.data().tier<equipData["tier"]){_curEffect.html("<span>"+db_config.item.effect.type[e.type]+" "+e.name+"：</span>"+e.effect);_curEffect.data().tier=equipData["tier"]}}break;case"unique_active":var _curEffect=equipDataActive.find("[data-name="+e.name+"]");if(_curEffect.length<1){equipDataActive.append('<p data-name="'+e.name+'" data-tier="'+equipData["tier"]+'" ><span>'+db_config.item.effect.type[e.type]+" "+e.name+"：</span>"+e.effect+"</p>")}else{if(_curEffect.data().tier<equipData["tier"]){_curEffect.html("<span>"+db_config.item.effect.type[e.type]+" "+e.name+"：</span>"+e.effect);_curEffect.data().tier=equipData["tier"]}}break;case"passive":equipDataPassive.prepend('<p data-name="'+e.name+'" data-tier="'+equipData["tier"]+'" ><span>'+e.type+" "+e.name+"：</span>"+e.effect+"</p>");break}})})}equipSelectItem.on("click",function(event){event.preventDefault();treeItem.removeClass("on");$line1.add($line2).hide();var _self=$(this);_self.addClass("on").siblings().removeClass("on");var category=_self.data().category;treeItem.hide().filter(function(){if($(this).data().category==category)return this}).show()})})();(function(){var runeSearchBox=$("#runeSearchBox"),runeResultBox=$("#runeResultBox"),resultItem=runeResultBox.find(".mod-iconitem");runeSearchBox.find(".select-box").each(function(index,el){var _self=$(this),s_input=_self.find(".input-box"),s_value=s_input.find(".value"),s_select=s_input.find("select");s_select.on("change",function(){event.preventDefault();s_value.html(s_select.find("option:selected").text());var color=runeSearchBox.find('select[name="color"]').val(),tier=runeSearchBox.find('select[name="tier"]').val(),category=runeSearchBox.find('select[name="category"]').val();if(!color&&!tier&&!category){resultItem.show()}else{resultItem.hide().filter(function(index){var _self=$(this);if((_self.data().color==color||color=="0"||!color)&&(_self.data().tier==tier||tier=="0"||!tier)&&(_self.data().category.indexOf(category)>-1||category=="0"||!category))return this}).show()}if(resultItem.filter(":visible").length<1){var noResult=runeResultBox.find(".no-result");if(noResult.length){noResult.show()}else{runeResultBox.append('<p class="no-result">sorry！目前并无此铭文</p>')}}else{var noResult=runeResultBox.find(".no-result");if(noResult.length)noResult.hide()}})})})();(function(){var glyphContBox=$("#runeResultBox"),glyphBoxItem=glyphContBox.find(".mod-iconitem"),glyphTreeBox=$("#glyph-tree-box"),glyphTreeItem=glyphTreeBox.find(".glyph-item");var runeSearchBox=$("#runeSearchBox"),runeResultBox=$("#runeResultBox"),resultItem=runeResultBox.find(".mod-iconitem");runeSearchItem=runeSearchBox.find(".select-box");var selectedGlyph={};var normalAttrBox=$("#normal_attr"),riskAttrBox=$("#risk_attr");glyphTreeItem.on("click",function(event){event.preventDefault();glyphTreeItem.removeClass("on");var _self=$(this),_parent=_self.parent();_self.addClass("on");if(_parent.hasClass("green-glyph")){runeSearchItem.eq(0).find(".value").text("绿");runeSearchItem.find('select[name="color"]').val("green")}else if(_parent.hasClass("blue-glyph")){runeSearchItem.eq(0).find(".value").text("蓝");runeSearchItem.find('select[name="color"]').val("blue")}else if(_parent.hasClass("red-glyph")){runeSearchItem.eq(0).find(".value").text("红");runeSearchItem.find('select[name="color"]').val("red")}runeSearchItem.eq(1).find(".value").text("全部");runeSearchItem.find('select[name="tier"]').val(0);runeSearchItem.eq(2).find(".value").text("全部");runeSearchItem.find('select[name="category"]').val(0);returnGlyphSelect()});function returnGlyphSelect(){var color=runeSearchBox.find('select[name="color"]').val(),tier=runeSearchBox.find('select[name="tier"]').val(),category=runeSearchBox.find('select[name="category"]').val();if(!color&&!tier&&!category){resultItem.show()}else{resultItem.hide().filter(function(index){var _self=$(this);if((_self.data().color==color||color=="0"||!color)&&(_self.data().tier==tier||tier=="0"||!tier)&&(_self.data().category.indexOf(category)>-1||category=="0"||!category))return this}).show()}if(resultItem.filter(":visible").length<1){var noResult=runeResultBox.find(".no-result");if(noResult.length){noResult.show()}else{runeResultBox.append('<p class="no-result">sorry！目前并无此铭文</p>')}}else{var noResult=runeResultBox.find(".no-result");if(noResult.length)noResult.hide()}}glyphBoxItem.each(function(index,el){var _self=$(this);var attributesSummary={normal:[],risk:[]},normalAttributesSummary=attributesSummary["normal"],riskAttributesSummary=attributesSummary["risk"];_self.on("click",function(event){event.preventDefault();var curGlyphTreeItem=glyphTreeItem.filter(".on");nextCur=curGlyphTreeItem.next();if(curGlyphTreeItem.length>0){var curGlyphTreeItemParent=curGlyphTreeItem.parent();if(curGlyphTreeItemParent.data().color==_self.data().color){curGlyphTreeItem.html(_self.find("img").clone());if(selectedGlyph[_self.data().color]==undefined){selectedGlyph[_self.data().color]=[]}var $glyphColorArray=selectedGlyph[_self.data().color];$glyphColorArray[curGlyphTreeItem.index()]=_self.data().rid;if(nextCur.length>0){curGlyphTreeItem.removeClass("on");nextCur.addClass("on")}normalAttrBox.add(riskAttrBox).find("dl").each(function(){$(this).data().point=0;$(this).data().percent=0;$(this).find("dd").text(0);$(this).hide()});for(ele in selectedGlyph){selectedGlyph[ele].map(function(_ele,_index){var $rune=all_rune[_ele],$runeAttribute=$rune["info"]["attribute"];$runeAttribute.map(function(e,i){if(e.type=="risk"){var _curAttr=riskAttrBox.find("."+e.attribute);_curAttrData=_curAttr.data();_curAttr.show();if(e.unit=="point"){_curAttrData.point+=parseFloat(e.value)}else if(e.unit=="percent"){_curAttrData.percent+=parseFloat(e.value)}_curAttr.find("dd").text(function(){var value="";if(_curAttrData.point>0){value+="+"+_curAttrData.point.toFixed(2)}if(_curAttrData.percent>0){if(_curAttrData.point>0){value+=", "}value+="+"+_curAttrData.percent.toFixed(2)+"%"}if(_curAttrData.point==0&&_curAttrData.percent==0){value=0}return value})}else if(e.type=="normal"){var _curAttr=normalAttrBox.find("."+e.attribute);_curAttrData=_curAttr.data();_curAttr.show();if(e.unit=="point"){_curAttrData.point+=parseFloat(e.value)}else if(e.unit=="percent"){_curAttrData.percent+=parseFloat(e.value)}_curAttr.find("dd").text(function(){var value="";if(_curAttrData.point>0){value+="+"+_curAttrData.point.toFixed(2)}if(_curAttrData.percent>0){if(_curAttrData.point>0){value+=", "}value+="+"+_curAttrData.percent.toFixed(2)+"%"}if(_curAttrData.point==0&&_curAttrData.percent==0){value=0}return value})}})})}}else{alert("请选择对应颜色的铭文")}}})});$("#glyph-tree-reset-btn").on("click",function(event){event.preventDefault();glyphTreeItem.html("").removeClass("on");selectedGlyph={};normalAttrBox.add(riskAttrBox).find("dl").each(function(){$(this).data().point=0;$(this).data().percent=0;$(this).find("dd").text(0);$(this).hide()})})})();(function(){var ringSearchBox=$("#ringSearchBox"),ringSearchOption=ringSearchBox.find(".select-box li"),ringResultBox=$("#ringResultBox"),resultItem=ringResultBox.find(".mod-iconitem");ringSearchOption.each(function(index,el){var _self=$(this);_self.on("click",function(event){event.preventDefault();if(_self.hasClass("on"))return;_self.addClass("on").siblings().removeClass("on");var _category=_self.data().category;resultItem.hide().filter(function(index){var that=$(this);if(that.data().category==_category)return this}).show()})})})();$(function(){$(".mod-srcollbox").each(function(){var _self=$(this),scrollList=_self.find(".mod-iconlist"),scrollItem=scrollList.find(".mod-iconitem");scrollList.width(scrollItem.innerWidth()*scrollItem.length)});$(".hero-skin-box").each(function(index,el){var heroSkinBox=new Swiper(".hero-skin-box",{loop:true});$(".hero-skin-tab-cont li").on("click",function(event){event.preventDefault();var _self=$(this);heroSkinBox.slideTo(_self.index()+1,500,false)})});$(".hero-skill-item .skill-box").each(function(){var box=$(this),box2=$(".hero-skill-item .skill-box2"),boxHeight=box.innerHeight(),box2Height=box2.innerHeight(),boxIconHeigt=box.find(".skill-icon").innerHeight(),box2IconHeigt=box2.find(".skill-icon").innerHeight();if(boxHeight>box2Height){box2.find(".mod-des-box p").css("height",boxHeight+"px")}else if(boxHeight<box2Height){box.find(".mod-des-box p").css("height",box2Height-133-22+"px")}});$(".equipment-custom-list li").css({height:($(window).width()-42+8)/6-10+"px"});$(".glyph-search-list").each(function(index,el){var _self=$(this),iconList=_self.find("ul"),iconItem=_self.find(".mod-iconitem");iconList.css({"max-height":iconItem.innerHeight()*3+10+"px"})});tab($(".musiclist-tab li"),$(".musiclist-item"),"on","click");tab($(".hero-other-box-tab li"),$(".hero-other-box-item"),"on","click");tab($(".hero-skill-tab li"),$(".hero-skill-cont p"),"on","click");$(".mod-select-tab").each(function(index,el){var _tab=$(this),_tabItem=_tab.find("li"),_cont=_tab.next(".mod-select-cont");if(!_cont)return;var _contItem=_cont.find(".cont-item");tab(_tabItem,_contItem,"on","click")})})});